
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Introduction to polynomial regression &#8212; tesuract 1.0 documentation</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=84ace793992934648b4de8eed757e5a2" />
    <link rel="stylesheet" href="../../_static/style.css" type="text/css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx-book-theme.9d8b4a8b9bb19db25eeaddc40d639ba2.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link href="../../_static/style.css" rel="stylesheet" type="text/css">

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<div class="col-12 col-md-3 bd-sidebar site-navigation " id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">tesuract 1.0 documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Introduction
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../introduction.html">
   Main features
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../install.html">
   Installation
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  User Guide
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Polynomial_fitting.html">
   Fitting with sklearn’s API
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Model_comparison.html">
   Model comparison
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Hyperparameter_tuning.html">
   Hyper-parameter tuning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Feature_importances.html">
   Feature Importances
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Tensor_surrogates.html">
   Tensor or field surrogates
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  API
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../api.html">
   PCE Base Class
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../api2.html">
   PCE Regression Class
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<!-- This is an invisible pixel that we watch to see if we've scrolled. -->
<div class="sbt-scroll-pixel-helper"></div>
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            <div class="topbar-left">
                
                <label class="nav-toggle-button" for="__navigation">
                    <div class="visually-hidden">Toggle navigation</div>
                    <i class="fas fa-bars"></i>
                </label>
                
            </div>
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/tutorials/old/tutorial01.rst.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.rst</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/kennychowdhary/tesuract"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup-the-problem">
   Setup the problem
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fit-a-polynomial">
   Fit a polynomial
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#feature-importance">
   Feature importance
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#prediction">
   Prediction
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#scale-error">
     Scale error
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#different-fit-algorithms">
   Different fit algorithms
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Introduction to polynomial regression</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup-the-problem">
   Setup the problem
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fit-a-polynomial">
   Fit a polynomial
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#feature-importance">
   Feature importance
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#prediction">
   Prediction
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#scale-error">
     Scale error
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#different-fit-algorithms">
   Different fit algorithms
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="section" id="introduction-to-polynomial-regression">
<h1>Introduction to polynomial regression<a class="headerlink" href="#introduction-to-polynomial-regression" title="Permalink to this headline">¶</a></h1>
<p>Let’s start my first importing the pypce library and any third party
libraries we might need like numpy or matplotlib.</p>
<div class="section" id="setup-the-problem">
<h2>Setup the problem<a class="headerlink" href="#setup-the-problem" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kn">import</span> <span class="nn">pypce</span>
<span class="linenos">2</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="linenos">3</span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">mpl</span>
</pre></div>
</div>
<p>Now, let’s generate some two-dimensional multivariate data to show how
pypce works!</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">rn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="linenos">2</span><span class="n">X</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">rn</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
<span class="linenos">3</span><span class="n">y</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">.5</span><span class="o">*</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">X</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos">4</span><span class="nb">print</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="mi">100</span><span class="p">,)</span>
</pre></div>
</div>
<p>This generate a data matrix <span class="math notranslate nohighlight">\(X\)</span> of size (nsamples,dim) and labeled
data <span class="math notranslate nohighlight">\(y\)</span> of shape (nsamples,). We can plot the univariate data
using matplotlib.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">mpl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">y</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span> <span class="n">at</span> <span class="mh">0x1408ada10</span><span class="o">&gt;</span><span class="p">]</span>
</pre></div>
</div>
<img alt="tutorials/old/tutorial01_files/tutorial01_6_1.png" src="tutorials/old/tutorial01_files/tutorial01_6_1.png" />
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">mpl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">y</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span> <span class="n">at</span> <span class="mh">0x143057290</span><span class="o">&gt;</span><span class="p">]</span>
</pre></div>
</div>
<img alt="tutorials/old/tutorial01_files/tutorial01_7_1.png" src="tutorials/old/tutorial01_files/tutorial01_7_1.png" />
<p>Note that the <span class="math notranslate nohighlight">\(x_1\)</span> dependence on <span class="math notranslate nohighlight">\(y\)</span> is more linear,
whereas the <span class="math notranslate nohighlight">\(x_2\)</span> dependence is quadratic, which is done by
construction. Let’s keep this in mind so that we can make sure the
polynomial fit we obtain reflects this relation.</p>
</div>
<div class="section" id="fit-a-polynomial">
<h2>Fit a polynomial<a class="headerlink" href="#fit-a-polynomial" title="Permalink to this headline">¶</a></h2>
<p>Now let’s fit the polynomial. To do this we need to initialize the PCE
regression class. To do this, we need to define the order of the
polynomial we want to fit and the fit algorithm. These two common
parameters are referred to as hyper-parameters. We can optimize over
them later using the grid search methods in sklearn. For now, let us
choose a second order polynomial and a least squares fit algorithm.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">pce</span> <span class="o">=</span> <span class="n">pypce</span><span class="o">.</span><span class="n">PCEReg</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">fit_type</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Initialization is fast since no computation or basis construction has
been done. It is when we fit the polynomial that the basis construction
takes place. So let’s fit the polynomial!</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">pce</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PCEReg</span><span class="p">(</span><span class="n">coef</span><span class="o">=</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.</span>        <span class="p">,</span>  <span class="mf">0.99913597</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.</span>        <span class="p">,</span>  <span class="mf">0.</span>        <span class="p">,</span> <span class="o">-</span><span class="mf">0.</span>        <span class="p">,</span>
        <span class="mf">0.99834676</span><span class="p">]),</span>
       <span class="n">fit_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;l1_ratio&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.999</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                   <span class="s1">&#39;n_alphas&#39;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span> <span class="s1">&#39;tol&#39;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">},</span>
       <span class="n">fit_type</span><span class="o">=</span><span class="s1">&#39;ElasticNetCV&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This returns the object back and displays the coefficient vector. For
all intents and purposes, a user does not need to know what the
coefficients are, but for purposes of this tutorial, let us take a look
so that we can verify that the fit is correct.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;c=</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">pce</span><span class="o">.</span><span class="n">coef</span><span class="p">)</span>
<span class="linenos">2</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;multi-index:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">pce</span><span class="o">.</span><span class="n">mindex</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="o">=</span>
 <span class="p">[</span> <span class="mf">3.68829304e-17</span>  <span class="mf">1.00000000e+00</span> <span class="o">-</span><span class="mf">1.11022302e-15</span>  <span class="mf">4.44089210e-16</span>
 <span class="o">-</span><span class="mf">1.11022302e-16</span>  <span class="mf">1.00000000e+00</span><span class="p">]</span>
<span class="n">multi</span><span class="o">-</span><span class="n">index</span><span class="p">:</span>
 <span class="p">[[</span><span class="mi">0</span> <span class="mi">0</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">1</span> <span class="mi">0</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">2</span> <span class="mi">0</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">1</span> <span class="mi">1</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">0</span> <span class="mi">2</span><span class="p">]]</span>
</pre></div>
</div>
<p>Notice that coefficient array contains all zeros (essentially) except
for the second and last entries. This is actually by design! We defined
the function <span class="math notranslate nohighlight">\(y\)</span> to be a simple sum of the first order Legendre
polynomial in <span class="math notranslate nohighlight">\(x_1\)</span> and the second order Legendre polynomial in
<span class="math notranslate nohighlight">\(x_2\)</span>. And if we look at the multi-index array, which represents
the components of each basis function, the second and last row
correspond to these exact polynomial terms. To be explicit, the
multi-index row <span class="math notranslate nohighlight">\([p,q]\)</span> represents the basis corresponding to the
product of the <span class="math notranslate nohighlight">\(p^{th}\)</span> order polynomial in <span class="math notranslate nohighlight">\(x_1\)</span> and the
<span class="math notranslate nohighlight">\(q^{th}\)</span> order polynomial in <span class="math notranslate nohighlight">\(x_2\)</span>.</p>
<p>Two final points before we move on. The linear fit algorithm worked
perfectly well since our data was not corrupted by noise. When noise
becomes a problem, or we expect outliers, it is probably better to use
the LassoCV or ElasticNetCV algorithms. The good news is that we have
wrappers that allow the user to perform a simple hyper-parameter search
to figure out the best fit. To show that a fit with regression would not
work well for this case, look at the following.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">pce_lasso</span> <span class="o">=</span> <span class="n">pypce</span><span class="o">.</span><span class="n">PCEReg</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">fit_type</span><span class="o">=</span><span class="s1">&#39;LassoCV&#39;</span><span class="p">)</span>
<span class="linenos">2</span><span class="n">pce_lasso</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PCEReg</span><span class="p">(</span><span class="n">coef</span><span class="o">=</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">4.23429475e-04</span><span class="p">,</span>  <span class="mf">1.00037195e+00</span><span class="p">,</span>  <span class="mf">2.12998050e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.61174005e-04</span><span class="p">,</span>
       <span class="o">-</span><span class="mf">5.52452618e-04</span><span class="p">,</span>  <span class="mf">9.99757827e-01</span><span class="p">]),</span>
       <span class="n">fit_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;alphas&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span><span class="mf">1.00000000e-12</span><span class="p">,</span> <span class="mf">3.83118685e-12</span><span class="p">,</span> <span class="mf">1.46779927e-11</span><span class="p">,</span> <span class="mf">5.62341325e-11</span><span class="p">,</span>
       <span class="mf">2.15443469e-10</span><span class="p">,</span> <span class="mf">8.25404185e-10</span><span class="p">,</span> <span class="mf">3.16227766e-09</span><span class="p">,</span> <span class="mf">1.21152766e-08</span><span class="p">,</span>
       <span class="mf">4.64158883e-08</span><span class="p">,</span> <span class="mf">1.77827941e-07</span><span class="p">,</span> <span class="mf">6.81292069e-07</span><span class="p">,</span> <span class="mf">2.61015722e-06</span><span class="p">,</span>
       <span class="mf">1.00000000e-05</span><span class="p">,</span> <span class="mf">3.83118685e-05</span><span class="p">,</span> <span class="mf">1.46779927e-04</span><span class="p">,</span> <span class="mf">5.62341325e-04</span><span class="p">,</span>
       <span class="mf">2.15443469e-03</span><span class="p">,</span> <span class="mf">8.25404185e-03</span><span class="p">,</span> <span class="mf">3.16227766e-02</span><span class="p">,</span> <span class="mf">1.21152766e-01</span><span class="p">,</span>
       <span class="mf">4.64158883e-01</span><span class="p">,</span> <span class="mf">1.77827941e+00</span><span class="p">,</span> <span class="mf">6.81292069e+00</span><span class="p">,</span> <span class="mf">2.61015722e+01</span><span class="p">,</span>
       <span class="mf">1.00000000e+02</span><span class="p">]),</span>
                   <span class="s1">&#39;max_iter&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;tol&#39;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">},</span>
       <span class="n">fit_type</span><span class="o">=</span><span class="s1">&#39;LassoCV&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The coefficient array in this case is over regularized but it’s not bad.
This is because the LassoCV is allowed to find the best regularization
parameter, which in this case it <span class="math notranslate nohighlight">\(0\)</span>.</p>
</div>
<div class="section" id="feature-importance">
<h2>Feature importance<a class="headerlink" href="#feature-importance" title="Permalink to this headline">¶</a></h2>
<p>Let’s us now see how we can show the feature importances. For
polynomials, we use the total order Sobol sensitivity indices. This is
essentially a weighted average of the polynomial coefficients. This is
one of the nice properties of using orthogonal polynomials.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">pce</span><span class="o">.</span><span class="n">feature_importances_</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([</span><span class="mf">0.625</span><span class="p">,</span> <span class="mf">0.375</span><span class="p">])</span>
</pre></div>
</div>
<p>Sobol sensitivity indices essentially give us a metric for how much of
the total variance is explained by each individual variance. So what
this says is that <span class="math notranslate nohighlight">\(x_1\)</span> is more importance to the variability of
the output. This doesn’t mean that <span class="math notranslate nohighlight">\(x_2\)</span> doesn’t matter. Note the
syntax is similar to the random forest feature importance syntax in
sklearn.</p>
</div>
<div class="section" id="prediction">
<h2>Prediction<a class="headerlink" href="#prediction" title="Permalink to this headline">¶</a></h2>
<p>Once the coefficient array is determined, typically by the fit function
or (less commonly) by pre-defining the coefficient array in the
constructor, we can make predictions. This is quite simple by using the
<code class="docutils literal notranslate"><span class="pre">predict</span></code> class method.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">ypred</span> <span class="o">=</span> <span class="n">pce</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="linenos">2</span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MSE: </span><span class="si">{0:2E}</span><span class="s1">, </span><span class="se">\n</span><span class="s1">MPE: </span><span class="si">{1:3E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">ypred</span><span class="o">-</span><span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">ypred</span><span class="o">-</span><span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MSE</span><span class="p">:</span> <span class="mf">6.985656E-31</span><span class="p">,</span>
<span class="n">MPE</span><span class="p">:</span> <span class="mf">3.553763E-26</span>
</pre></div>
</div>
<p>We can see this in another way by plotting the prediction vs the truth.
Ideally, the graph should align perfectly with a y=x line plot.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">mpl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="linenos">2</span><span class="n">mpl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">ypred</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span> <span class="n">at</span> <span class="mh">0x145123410</span><span class="o">&gt;</span><span class="p">]</span>
</pre></div>
</div>
<img alt="tutorials/old/tutorial01_files/tutorial01_24_1.png" src="tutorials/old/tutorial01_files/tutorial01_24_1.png" />
<div class="section" id="scale-error">
<h3>Scale error<a class="headerlink" href="#scale-error" title="Permalink to this headline">¶</a></h3>
<p>We mentioned before that <span class="math notranslate nohighlight">\(X\)</span> must be scaled to be over [-1,1]
since the polynomials are defined on that range. Let’s see what happens
when we feed a polynomial outside that range.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">pce</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---------------------------------------------------------------------------</span>

<span class="ne">AssertionError</span>                            <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>

<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="n">d32815d055ad</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">pce</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>


<span class="o">~/.</span><span class="n">pyenv</span><span class="o">/</span><span class="n">versions</span><span class="o">/</span><span class="mf">3.7.6</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">pypce</span><span class="o">/</span><span class="n">pce</span><span class="o">.</span><span class="n">py</span> <span class="ow">in</span> <span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="mi">858</span>         <span class="c1"># get data attributes</span>
    <span class="mi">859</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_n</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_dim</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span>
<span class="o">--&gt;</span> <span class="mi">860</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_compile</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="c1"># build multindex and construct basis</span>
    <span class="mi">861</span>         <span class="n">Xhat</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">check_X_y</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Xhat</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
    <span class="mi">862</span>         <span class="c1"># pypce.PCEBuilder(dim=self.dim,self.order)</span>


<span class="o">~/.</span><span class="n">pyenv</span><span class="o">/</span><span class="n">versions</span><span class="o">/</span><span class="mf">3.7.6</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">pypce</span><span class="o">/</span><span class="n">pce</span><span class="o">.</span><span class="n">py</span> <span class="ow">in</span> <span class="n">_compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
    <span class="mi">799</span>         <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dim</span><span class="p">)</span> <span class="c1"># use parent compile to produce the multiindex</span>
    <span class="mi">800</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiindex</span>
<span class="o">--&gt;</span> <span class="mi">801</span>         <span class="bp">self</span><span class="o">.</span><span class="n">Xhat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="mi">802</span>         <span class="k">return</span> <span class="bp">self</span>
    <span class="mi">803</span>     <span class="k">def</span> <span class="nf">_quad_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>


<span class="o">~/.</span><span class="n">pyenv</span><span class="o">/</span><span class="n">versions</span><span class="o">/</span><span class="mf">3.7.6</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">pypce</span><span class="o">/</span><span class="n">pce</span><span class="o">.</span><span class="n">py</span> <span class="ow">in</span> <span class="n">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
    <span class="mi">360</span>         <span class="c1"># only works for [-1,1] for far</span>
    <span class="mi">361</span>         <span class="c1"># compute multindex</span>
<span class="o">--&gt;</span> <span class="mi">362</span>         <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;range for X must be between -1 and 1 for now. scale inputs accordingly. &quot;</span>
    <span class="mi">363</span>         <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="mi">364</span>         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mindex</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>


<span class="ne">AssertionError</span><span class="p">:</span> <span class="nb">range</span> <span class="k">for</span> <span class="n">X</span> <span class="n">must</span> <span class="n">be</span> <span class="n">between</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">now</span><span class="o">.</span> <span class="n">scale</span> <span class="n">inputs</span> <span class="n">accordingly</span><span class="o">.</span>
</pre></div>
</div>
<p>Note that we will NOT get an error if X is defined on <span class="math notranslate nohighlight">\([0,1]\)</span>.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">pce</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="mf">.5</span><span class="o">*</span><span class="p">(</span><span class="n">X</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PCEReg</span><span class="p">(</span><span class="n">coef</span><span class="o">=</span><span class="n">array</span><span class="p">([</span> <span class="mf">1.49367831</span><span class="p">,</span>  <span class="mf">1.77311607</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.79944048</span><span class="p">,</span>  <span class="mf">0.16374152</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.</span>        <span class="p">,</span>
        <span class="mf">3.24392684</span><span class="p">]),</span>
       <span class="n">fit_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;l1_ratio&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.999</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                   <span class="s1">&#39;n_alphas&#39;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span> <span class="s1">&#39;tol&#39;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">},</span>
       <span class="n">fit_type</span><span class="o">=</span><span class="s1">&#39;ElasticNetCV&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In this case, the fit will not be what one expects since we expect the
input to be on [-1,1]. So be careful!!</p>
</div>
</div>
<div class="section" id="different-fit-algorithms">
<h2>Different fit algorithms<a class="headerlink" href="#different-fit-algorithms" title="Permalink to this headline">¶</a></h2>
<p>Now let’s look at the accuracy of different fit algorithms. In this
example, we will train and test on the same set, but in a formal
setting, you should not do that (we will explore this in later
tutorials).</p>
<p>The different fit algorithms from sklearn are LassoCV, ElasticNetCV,
OmpCV, and linear least squares. We will fit a polynomial for each one
of these algorithms with and without noise to see how accurate they are.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">algs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="s1">&#39;LassoCV&#39;</span><span class="p">,</span> <span class="s1">&#39;ElasticNetCV&#39;</span><span class="p">]</span>
<span class="linenos">2</span><span class="k">for</span> <span class="n">alg</span> <span class="ow">in</span> <span class="n">algs</span><span class="p">:</span>
<span class="linenos">3</span>    <span class="n">pce</span> <span class="o">=</span> <span class="n">pypce</span><span class="o">.</span><span class="n">PCEReg</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">fit_type</span><span class="o">=</span><span class="n">alg</span><span class="p">)</span>
<span class="linenos">4</span>    <span class="n">pce</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="linenos">5</span>    <span class="n">ypred</span> <span class="o">=</span> <span class="n">pce</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="linenos">6</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error using </span><span class="si">{0}</span><span class="s2">: </span><span class="si">{1:.3E}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">alg</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">ypred</span><span class="o">-</span><span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="n">using</span> <span class="n">linear</span><span class="p">:</span> <span class="mf">6.986E-29</span>
<span class="n">Error</span> <span class="n">using</span> <span class="n">LassoCV</span><span class="p">:</span> <span class="mf">2.085E-05</span>
<span class="n">Error</span> <span class="n">using</span> <span class="n">ElasticNetCV</span><span class="p">:</span> <span class="mf">7.523E-05</span>
</pre></div>
</div>
<p>They are all pretty good, but linear least squares gives the best fit.
Now, let’s try the same with noise! First, let us create an output
corrupted by simple additive white noise</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">y_w_noise</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="o">+</span> <span class="mf">.1</span><span class="o">*</span><span class="n">rn</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">algs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="s1">&#39;LassoCV&#39;</span><span class="p">,</span> <span class="s1">&#39;ElasticNetCV&#39;</span><span class="p">]</span>
<span class="linenos">2</span><span class="k">for</span> <span class="n">alg</span> <span class="ow">in</span> <span class="n">algs</span><span class="p">:</span>
<span class="linenos">3</span>    <span class="n">pce</span> <span class="o">=</span> <span class="n">pypce</span><span class="o">.</span><span class="n">PCEReg</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">fit_type</span><span class="o">=</span><span class="n">alg</span><span class="p">)</span>
<span class="linenos">4</span>    <span class="n">pce</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y_w_noise</span><span class="p">)</span>
<span class="linenos">5</span>    <span class="n">ypred</span> <span class="o">=</span> <span class="n">pce</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="linenos">6</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error using </span><span class="si">{0}</span><span class="s2">: </span><span class="si">{1:.3E}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">alg</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">ypred</span><span class="o">-</span><span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="n">using</span> <span class="n">linear</span><span class="p">:</span> <span class="mf">4.601E-02</span>
<span class="n">Error</span> <span class="n">using</span> <span class="n">LassoCV</span><span class="p">:</span> <span class="mf">2.747E-02</span>
<span class="n">Error</span> <span class="n">using</span> <span class="n">ElasticNetCV</span><span class="p">:</span> <span class="mf">2.552E-02</span>
</pre></div>
</div>
<p>This time, LassoCV or ElasticNetCV give the best solution!</p>
</div>
</div>


              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By K. Chowdhary<br/>
    
        &copy; Copyright 2020, K. Chowdhary.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>